<!DOCTYPE html><html><head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../">
  <title data-ice="title">Manual | Badger Database</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<link rel="stylesheet" href="./inject/css/0-badger.css"><meta name="description" content="Javascript database abstraction layer"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="Badger Database"><meta property="twitter:description" content="Javascript database abstraction layer"></head>
<body class="layout-container manual-root" data-ice="rootContainer">

<header>
  <a href="./" style="display: flex; align-items: center;"><img src="./image/brand_logo.svg" style="width:34px;"></a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/abw/badger-database-js"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div class="manual-toc-root">
  
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/installation.html"><a href="manual/installation.html" data-ice="link">Installation</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/installation.html"><a href="manual/installation.html#npm" data-ice="link">npm</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/installation.html"><a href="manual/installation.html#pnpm" data-ice="link">pnpm</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/installation.html"><a href="manual/installation.html#yarn" data-ice="link">yarn</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/installation.html"><a href="manual/installation.html#where-next-" data-ice="link">Where Next?</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/connecting.html"><a href="manual/connecting.html" data-ice="link">Connecting</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/connecting.html"><a href="manual/connecting.html#connection-string" data-ice="link">Connection String</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/connecting.html"><a href="manual/connecting.html#connection-parameters" data-ice="link">Connection Parameters</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/connecting.html"><a href="manual/connecting.html#connection-parameter-aliases" data-ice="link">Connection Parameter Aliases</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/connecting.html"><a href="manual/connecting.html#environment-variables" data-ice="link">Environment Variables</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/connecting.html"><a href="manual/connecting.html#pool-options" data-ice="link">Pool Options</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/connecting.html"><a href="manual/connecting.html#disconnecting" data-ice="link">Disconnecting</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/connecting.html"><a href="manual/connecting.html#where-next-" data-ice="link">Where Next?</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/basic_queries.html"><a href="manual/basic_queries.html" data-ice="link">Basic Queries</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/basic_queries.html"><a href="manual/basic_queries.html#query-methods" data-ice="link">Query Methods</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/basic_queries.html"><a href="manual/basic_queries.html#run-query--values--options-" data-ice="link">run(query, values, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/basic_queries.html"><a href="manual/basic_queries.html#one-query--values--options-" data-ice="link">one(query, values, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/basic_queries.html"><a href="manual/basic_queries.html#any-query--values--options-" data-ice="link">any(query, values, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/basic_queries.html"><a href="manual/basic_queries.html#all-query--values--options-" data-ice="link">all(query, values, options)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/basic_queries.html"><a href="manual/basic_queries.html#where-next-" data-ice="link">Where Next?</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/named_queries.html"><a href="manual/named_queries.html" data-ice="link">Named Queries</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/named_queries.html"><a href="manual/named_queries.html#where-next-" data-ice="link">Where Next?</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/query_fragments.html"><a href="manual/query_fragments.html" data-ice="link">Query Fragments</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/query_fragments.html"><a href="manual/query_fragments.html#where-next-" data-ice="link">Where Next?</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/query_builder.html"><a href="manual/query_builder.html" data-ice="link">Query Builder</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/query_builder.html"><a href="manual/query_builder.html#introduction" data-ice="link">Introduction</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/query_builder.html"><a href="manual/query_builder.html#getting-started" data-ice="link">Getting Started</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/query_builder.html"><a href="manual/query_builder.html#select-queries" data-ice="link">Select Queries</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/query_builder.html"><a href="manual/query_builder.html#insert-queries" data-ice="link">Insert Queries</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/query_builder.html"><a href="manual/query_builder.html#update-queries" data-ice="link">Update Queries</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/query_builder.html"><a href="manual/query_builder.html#delete-queries" data-ice="link">Delete Queries</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/query_builder.html"><a href="manual/query_builder.html#embedding-raw-sql" data-ice="link">Embedding Raw SQL</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/query_builder.html"><a href="manual/query_builder.html#placeholder-values" data-ice="link">Placeholder Values</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/query_builder.html"><a href="manual/query_builder.html#running-queries" data-ice="link">Running Queries</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/query_builder.html"><a href="manual/query_builder.html#the-importance-of-being-idempotent" data-ice="link">The Importance of Being Idempotent</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/query_builder.html"><a href="manual/query_builder.html#named-queries-using-a-query-builder" data-ice="link">Named Queries Using a Query Builder</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/query_builder.html"><a href="manual/query_builder.html#where-next-" data-ice="link">Where Next?</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html" data-ice="link">Query Builder Methods</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#select-queries" data-ice="link">Select Queries</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#select-columns-" data-ice="link">select(columns)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#from-table-" data-ice="link">from(table)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#where-criteria-" data-ice="link">where(criteria)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#join-table-" data-ice="link">join(table)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#order-columns-" data-ice="link">order(columns)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#group-columns-" data-ice="link">group(columns)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#having-criteria-" data-ice="link">having(criteria)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#limit-n-" data-ice="link">limit(n)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#offset-n-" data-ice="link">offset(n)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#range-from--to-" data-ice="link">range(from, to)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#columns-columns-" data-ice="link">columns(columns)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#table-table-" data-ice="link">table(table)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#prefix-prefix-" data-ice="link">prefix(prefix)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#insert-queries" data-ice="link">Insert Queries</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#insert-columns-" data-ice="link">insert(columns)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#into-table-" data-ice="link">into(table)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#values-values-" data-ice="link">values(values)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#returning-columns-" data-ice="link">returning(columns)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#update-queries" data-ice="link">Update Queries</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#update-table-" data-ice="link">update(table)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#set-values-" data-ice="link">set(values)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#delete-queries" data-ice="link">Delete Queries</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#delete--" data-ice="link">delete()</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#execution-methods" data-ice="link">Execution Methods</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#run-values--options-" data-ice="link">run(values, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#one-values--options-" data-ice="link">one(values, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#any-values--options-" data-ice="link">any(values, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#all-values--options-" data-ice="link">all(values, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#sql--" data-ice="link">sql()</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#placeholder-value-methods" data-ice="link">Placeholder Value Methods</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#setvalues--" data-ice="link">setValues()</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#wherevalues--" data-ice="link">whereValues()</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#havingvalues--" data-ice="link">havingValues()</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#allvalues--" data-ice="link">allValues()</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#where-next-" data-ice="link">Where Next?</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/tables.html"><a href="manual/tables.html" data-ice="link">Tables</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tables.html"><a href="manual/tables.html#insert--update--fetch-and-delete" data-ice="link">Insert, Update, Fetch and Delete</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tables.html"><a href="manual/tables.html#table-queries" data-ice="link">Table Queries</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tables.html"><a href="manual/tables.html#where-next-" data-ice="link">Where Next?</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/table_columns.html"><a href="manual/table_columns.html" data-ice="link">Table Columns</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_columns.html"><a href="manual/table_columns.html#column-flags" data-ice="link">Column Flags</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_columns.html"><a href="manual/table_columns.html#expanded-form" data-ice="link">Expanded Form</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_columns.html"><a href="manual/table_columns.html#where-next-" data-ice="link">Where Next?</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/table_methods.html"><a href="manual/table_methods.html" data-ice="link">Table Methods</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_methods.html"><a href="manual/table_methods.html#insert-methods" data-ice="link">Insert Methods</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#insert-data--options-" data-ice="link">insert(data, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#insertone-data--options-" data-ice="link">insertOne(data, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#insertall-array--options-" data-ice="link">insertAll(array, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#insertonerecord-data--options-" data-ice="link">insertOneRecord(data, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#insertallrecords-array--options-" data-ice="link">insertAllRecords(array, options)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_methods.html"><a href="manual/table_methods.html#update-methods" data-ice="link">Update Methods</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#update-set--where--options-" data-ice="link">update(set, where, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#updateone-set--where--options-" data-ice="link">updateOne(set, where, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#updateany-set--where--options-" data-ice="link">updateAny(set, where, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#updateall-set--where--options-" data-ice="link">updateAll(set, where, options)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_methods.html"><a href="manual/table_methods.html#delete-method" data-ice="link">Delete Method</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#delete-where-" data-ice="link">delete(where)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_methods.html"><a href="manual/table_methods.html#fetch-methods" data-ice="link">Fetch Methods</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#fetch-where--options-" data-ice="link">fetch(where, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#fetchone-where--options-" data-ice="link">fetchOne(where, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#fetchany-where--options-" data-ice="link">fetchAny(where, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#fetchall-where--options-" data-ice="link">fetchAll(where, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#fetchonerecord-where--options-" data-ice="link">fetchOneRecord(where, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#fetchanyrecord-where--options-" data-ice="link">fetchAnyRecord(where, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#fetchallrecords-where--options-" data-ice="link">fetchAllRecords(where, options)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_methods.html"><a href="manual/table_methods.html#record-methods" data-ice="link">Record Methods</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#record-row-" data-ice="link">record(row)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#records-rows-" data-ice="link">records(rows)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_methods.html"><a href="manual/table_methods.html#where-next-" data-ice="link">Where Next?</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/table_queries.html"><a href="manual/table_queries.html" data-ice="link">Table Queries</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_queries.html"><a href="manual/table_queries.html#sql-queries" data-ice="link">SQL Queries</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_queries.html"><a href="manual/table_queries.html#named-queries" data-ice="link">Named Queries</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_queries.html"><a href="manual/table_queries.html#query-fragments" data-ice="link">Query Fragments</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_queries.html"><a href="manual/table_queries.html#query-builder" data-ice="link">Query Builder</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_queries.html"><a href="manual/table_queries.html#query-methods" data-ice="link">Query Methods</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_queries.html"><a href="manual/table_queries.html#run-query--values--options-" data-ice="link">run(query, values, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_queries.html"><a href="manual/table_queries.html#one-query--values--options-" data-ice="link">one(query, values, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_queries.html"><a href="manual/table_queries.html#any-query--values--options-" data-ice="link">any(query, values, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_queries.html"><a href="manual/table_queries.html#all-query--values--options-" data-ice="link">all(query, values, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_queries.html"><a href="manual/table_queries.html#onerow-query--args-" data-ice="link">oneRow(query, args)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_queries.html"><a href="manual/table_queries.html#anyrow-query--args-" data-ice="link">anyRow(query, args)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_queries.html"><a href="manual/table_queries.html#allrows-query--args-" data-ice="link">allRows(query, args)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_queries.html"><a href="manual/table_queries.html#onerecord-query--args-" data-ice="link">oneRecord(query, args)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_queries.html"><a href="manual/table_queries.html#anyrecord-query--args-" data-ice="link">anyRecord(query, args)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_queries.html"><a href="manual/table_queries.html#allrecords-query--args-" data-ice="link">allRecords(query, args)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_queries.html"><a href="manual/table_queries.html#sql-query-" data-ice="link">sql(query)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_queries.html"><a href="manual/table_queries.html#where-next-" data-ice="link">Where Next?</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/table_class.html"><a href="manual/table_class.html" data-ice="link">Table Class</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_class.html"><a href="manual/table_class.html#table-configuration" data-ice="link">Table Configuration</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_class.html"><a href="manual/table_class.html#where-next-" data-ice="link">Where Next?</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/records.html"><a href="manual/records.html" data-ice="link">Records</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/records.html"><a href="manual/records.html#where-next-" data-ice="link">Where Next?</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/record_methods.html"><a href="manual/record_methods.html" data-ice="link">Record Methods</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/record_methods.html"><a href="manual/record_methods.html#update-set-" data-ice="link">update(set)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/record_methods.html"><a href="manual/record_methods.html#delete--" data-ice="link">delete()</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/record_methods.html"><a href="manual/record_methods.html#relation-name-" data-ice="link">relation(name)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/record_methods.html"><a href="manual/record_methods.html#where-next-" data-ice="link">Where Next?</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/record_class.html"><a href="manual/record_class.html" data-ice="link">Record Class</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/record_class.html"><a href="manual/record_class.html#record-configuration-options" data-ice="link">Record Configuration Options</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/record_class.html"><a href="manual/record_class.html#where-next-" data-ice="link">Where Next?</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/relations.html"><a href="manual/relations.html" data-ice="link">Relations</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/relations.html"><a href="manual/relations.html#introduction" data-ice="link">Introduction</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/relations.html"><a href="manual/relations.html#relation-types" data-ice="link">Relation Types</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/relations.html"><a href="manual/relations.html#defining-table-relations" data-ice="link">Defining Table Relations</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/relations.html"><a href="manual/relations.html#fetching-relations" data-ice="link">Fetching Relations</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/relations.html"><a href="manual/relations.html#additional-constraints" data-ice="link">Additional Constraints</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/relations.html"><a href="manual/relations.html#the-map-relation" data-ice="link">The Map Relation</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/relations.html"><a href="manual/relations.html#shorthand-syntax-for-defining-relations" data-ice="link">Shorthand Syntax for Defining Relations</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/relations.html"><a href="manual/relations.html#custom-queries" data-ice="link">Custom Queries</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/relations.html"><a href="manual/relations.html#where-next-" data-ice="link">Where Next?</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/model.html"><a href="manual/model.html" data-ice="link">Model</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/waiter.html"><a href="manual/waiter.html" data-ice="link">Waiter</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/debugging.html"><a href="manual/debugging.html" data-ice="link">Debugging</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/debugging.html"><a href="manual/debugging.html#sql-parse-errors" data-ice="link">SQL Parse Errors</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/extending.html"><a href="manual/extending.html" data-ice="link">Extending</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/extending.html"><a href="manual/extending.html#custom-tables-class" data-ice="link">Custom Tables Class</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/extending.html"><a href="manual/extending.html#custom-tables-object" data-ice="link">Custom Tables Object</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/extending.html"><a href="manual/extending.html#adding-query-builder-methods" data-ice="link">Adding Query Builder Methods</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/extending.html"><a href="manual/extending.html#adding-a-new-database-engine" data-ice="link">Adding a New Database Engine</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/extending.html"><a href="manual/extending.html#using-a-different-engine-driver" data-ice="link">Using a Different Engine Driver</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/limitations.html"><a href="manual/limitations.html" data-ice="link">Limitations</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/examples.html"><a href="manual/examples.html" data-ice="link">Examples</a></li>
</ul>
  </div>
</div>
</nav>

<div class="content" data-ice="content"><div class="github-markdown" data-ice="content"><h1 id="relations">Relations</h1><p>Relations are, rather unsurprisingly, at the heart of relational databases.</p>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#relation-types">Relation Types</a></li>
<li><a href="#defining-table-relations">Defining Table Relations</a></li>
<li><a href="#fetching-relations">Fetching Relations</a></li>
<li><a href="#additional-constraints">Additional Constraints</a></li>
<li><a href="#the-map-relation">The Map Relation</a></li>
<li><a href="#shorthand-syntax-for-defining-relations">Shorthand Syntax for Defining Relations</a></li>
<li><a href="#custom-queries">Custom Queries</a></li>
</ul>
<h2 id="introduction">Introduction</h2><p>To demonstrate the concepts we're going to use an overly simple schema for
a music database.  We'll assume that the database tables have already been
created and populated with some sample data.</p>
<p>One table will store the <code>artists</code>.</p>
<pre><code class="lang-sql"><code class="source-code prettyprint">CREATE TABLE artists (
  id   SERIAL,
  name TEXT,
  PRIMARY KEY (id)
)</code></code></pre>
<p>Another will store the albums that they release, including the <code>year</code> and <code>title</code>.
Note the <code>artist_id</code> which forms a relation to the artist that released the
album.  In this simple example we're going to assume that only one artist can
release an album.  This isn't the case in the real world if you consider things
like multi-artist collaborations and compilation albums, but we're just trying
to demonstrate the basic concepts here, not build the next Spotify.</p>
<pre><code class="lang-sql"><code class="source-code prettyprint">CREATE TABLE albums (
  id        SERIAL,
  year      INTEGER,
  title     TEXT,
  artist_id INTEGER,
  PRIMARY KEY (id),
  FOREIGN KEY (artist_id) REFERENCES artists(id)
)</code></code></pre>
<p>A third table will store the tracks on each album, include the track <code>title</code>,
the <code>album_id</code> linking it to the album that it appears on, and the <code>track_no</code>
to indicate it's position in the track listing for the album.  The <code>bonus</code>
column is a boolean value which defaults to false, which is used to indicate
"bonus tracks" that sometime appear on albums.</p>
<pre><code class="lang-sql"><code class="source-code prettyprint">CREATE TABLE tracks (
  id        SERIAL,
  title     TEXT,
  album_id  INTEGER,
  track_no  INTEGER,
  bonus     BOOLEAN DEFAULT false,
  PRIMARY KEY (id),
  FOREIGN KEY (album_id) REFERENCES albums(id)
)</code></code></pre>
<p>There's a complete working example of this code in the
<a href="https://github.com/abw/badger-database-js/tree/master/examples/07_musicdb/example.js">07_musicdb</a>
section of the <a href="https://github.com/abw/badger-database-js">github repository</a>.</p>
<h2 id="relation-types">Relation Types</h2><p>This example demonstrates two basic relation types: the "many to one" relation
that exists between artists and albums, and the "one to many" relation that
exists between albums and track.</p>
<p>Each artist can release many albums.  But in this simple example we're assuming
that an albums can only be released by one artist.  Therefore this is a "many
to one" relation.</p>
<p>Each album can have many tracks, but each track can only appear on a single album.
Therefore this is a "one to many" relation.</p>
<p>These two relations are given the names <code>one</code> and <code>many</code>. The <code>one</code> relation implies
that there is exactly one related record, whereas <code>many</code> implies there can be multiple
relations, including zero.  If you have a relation that <em>may</em> have one related record
then you can use the <code>any</code> relation.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Shorthand</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>one</td>
<td><code>from -&gt; table.to</code></td>
<td>Exactly one related record</td>
</tr>
<tr>
<td>any</td>
<td><code>from ~&gt; table.to</code></td>
<td>Maybe one related record</td>
</tr>
<tr>
<td>many</td>
<td><code>from =&gt; table.to</code></td>
<td>Any number of related records (including zero)</td>
</tr>
<tr>
<td>map</td>
<td><code>from #&gt; table.to</code></td>
<td>Mapping any number of related records (including zero)</td>
</tr>
</tbody></table>
<p>The final type <code>map</code> is a variant of the <code>many</code> relation.  Instead of returning an array
of related records, this relation returns them as an object mapping from the record id
(or another key of your choosing) to the record (or a value within it).  See
<a href="#the-map-relation">The Map Relation</a> below for further information.</p>
<h2 id="defining-table-relations">Defining Table Relations</h2><p>The relations for each table should be added to the <code>tables</code> configuration
as the <code>relations</code> object.  This is what our main database configuration
should look like.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const musicdb = connect({
  database: 'postgres://musicdb',
  tables: {
    artists: {
      columns: 'id name',
      relations: {
        albums: {
          type:  'many',
          from:  'id',
          to:    'artist_id',
          table: 'albums',
        }
      }
    },
    albums: {
      columns: 'id year title artist_id',
      relations: {
        artist: {
          type:   'one',
          from:   'artist_id',
          to:     'id',
          table:  'artists',
        },
        tracks: {
          type:   'many',
          from:   'id',
          to:     'album_id',
          table:  'tracks',
          order:  'track_no',
        }
      }
    }
    tracks: {
      columns: 'id title album_id track_no bonus',
      relations: {
        album: {
          type:   'one',
          from:   'album_id',
          to:     'id',
          table:  'albums',
        },
      }
    }
})</code></code></pre>
<p>The <code>artists</code> table has an <code>albums</code> relation which can include many albums.
The relation goes from the <code>id</code> column on the <code>artists</code> table to the
<code>artist_id</code> column on the <code>albums</code> table.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">// tables.artists.relations...
albums: {
  type:  'many',
  from:  'id',
  to:    'artist_id',
  table: 'albums',
}</code></code></pre>
<p>The <code>albums</code> table has two relations.  The <code>artist</code> relation is one
artist with the join going from the <code>artist_id</code> column on the <code>albums</code>
table to the <code>id</code> column on the <code>artists</code> table.  The <code>tracks</code> relation
is many tracks with the join going from the <code>id</code> column on the <code>tracks</code>
table to the <code>album_id</code> column on the <code>albums</code> table.  The tracks in
this relation should be ordered by the <code>track_no</code> column.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">// tables.albums.relations...
artist: {
  type:   'one',
  from:   'artist_id',
  to:     'id',
  table:  'artists',
},
tracks: {
  type:   'many',
  from:   'id',
  to:     'album_id',
  table:  'tracks',
  order:  'track_no',
}</code></code></pre>
<p>The <code>tracks</code> table has a single relation for the <code>album</code> that it appears on.
The join goes from the <code>album_id</code> column on the <code>tracks</code> table to the <code>id</code>
column on the <code>albums</code> table.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">// tables.tracks.relations...
album: {
  type:   'one',
  from:   'album_id',
  to:     'id',
  table:  'albums',
},</code></code></pre>
<h2 id="fetching-relations">Fetching Relations</h2><p>Let's assume we've got Pink Floyd defined as an artist, and their
seminal albums "The Dark Side of the Moon" and "Wish You Were Here"
have already been added to the database.</p>
<p>We can start by fetching an artist record for Pink Floyd.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const artists = await musicdb.table('artists');
const artist = await artists.oneRecord({ name: 'Pink Floyd' });</code></code></pre>
<p>The <code>relation()</code> method allows us to fetch all related records in
a relation.  The <code>albums</code> relation is defined as a <code>many</code> type, so
it returns an array of records from the <code>albums</code> table.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const albums = await artist.relation('albums');
console.log(albums[0].title);   // The Dark Side of the Moon
console.log(albums[1].title);   // Wish You Were Here</code></code></pre>
<p>The record proxy object allows you to simplify this.  If there's a
relation defined for a record then you can access it as a property
of the record.  Just remember that there's actually a method call
and database access going on behind the scenes so you have to <code>await</code>
the result.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const albums = await artist.albums;
console.log(albums[0].title);   // The Dark Side of the Moon
console.log(albums[1].title);   // Wish You Were Here</code></code></pre>
<p>We can take one of those albums and use the <code>artist</code> relation
to fetch the artist that recorded the album.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const dsotm = albums[0];
const artist = await dsotm.artist;
console.log(artist.name);   // Pink Floyd</code></code></pre>
<p>We can also fetch the tracks on the album.  They will be automatically
ordered by the <code>track_no</code> column.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const tracks = await dsotm.tracks;
console.log(tracks[0].title);  // Speak to Me / Breathe
console.log(tracks[1].title);  // On the Run
console.log(tracks[2].title);  // Time
console.log(tracks[3].title);  // The Great Gig in the Sky
// ...etc...</code></code></pre>
<p>And finally, we can go the other way and, for a given track,
we can fetch the album that it appears on.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const time = tracks[2];
const album = await time.album;
console.log(album.title);   // The Dark Side of the Moon</code></code></pre>
<h2 id="additional-constraints">Additional Constraints</h2><p>Additional constraints for a relation can be defined using the
<code>where</code> property.</p>
<p>For example, we might want to define the <code>tracks</code> relation
to only return tracks that aren't bonus tracks, and define a
new <code>bonus_tracks</code> relation for those that are.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">// tables.albums.relations...
tracks: {
  type:   'many',
  from:   'id',
  to:     'album_id',
  table:  'tracks',
  order:  'track_no',
  where:  { bonus: 0 }
},
bonus_tracks: {
  type:   'many',
  from:   'id',
  to:     'album_id',
  table:  'tracks',
  order:  'track_no',
  where:  { bonus: 1 }
}</code></code></pre>
<p>If your copy of The Dark Side of the Moon has
"Us and Them (Richard Wright Demo)" and "Money (Roger Waters Demo)"
included as bonus tracks (you lucky thing!) then you could fetch them
like so.  Assuming, of course, that they're in the database and have
the <code>bonus</code> columns set to <code>true</code> (or <code>1</code> which databases treat as the
same thing).</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const bonus = await dsotm.bonus_tracks;
console.log(bonus[0].title);  // Us and Them (Richard Wright Demo)
console.log(bonus[1].title);  // Money (Roger Waters Demo)</code></code></pre>
<h2 id="the-map-relation">The Map Relation</h2><p>The <code>map</code> relation is a special case of the <code>many</code> relation.  Instead of returning
an array of matching records, it returns an object mapping each record id to the record.</p>
<p>For example, if the <code>albums</code> relation for the <code>artists</code> table returns these records
for a particular artist:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">[
  { id: 123, year: 1973, title: 'The Dark Side of the Moon' },
  { id: 456, year: 1975, title: 'Wish You Were Here' },
  { id: 789, year: 1970, title: 'Atom Heart Mother' },
]</code></code></pre>
<p>Then the same relation defined as a <code>map</code> instead of <code>many</code> would return:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">{
  123: { id: 123, year: 1973, title: 'The Dark Side of the Moon' },
  456: { id: 456, year: 1975, title: 'Wish You Were Here' },
  789: { id: 789, year: 1970, title: 'Atom Heart Mother' },
}</code></code></pre>
<p>You can specify an additional <code>key</code> which will be used as the object key
instead of the record id.  For example, you might want to index the albums
by year:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">// tables.artists.relations...
albums: {
  type:  'map',
  from:  'id',
  to:    'artist_id',
  table: 'albums',
  key:   'year',
}</code></code></pre>
<p>Now the relation will return:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">{
  1973: { id: 123, year: 1973, title: 'The Dark Side of the Moon' },
  1975: { id: 456, year: 1975, title: 'Wish You Were Here' },
  1970: { id: 789, year: 1970, title: 'Atom Heart Mother' },
}</code></code></pre>
<p>You can also specify a <code>value</code> property.  Instead of mapping to the whole record,
it will extract that value from the record.  So if the relation is defined
like this:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">// tables.artists.relations...
albums: {
  type:  'map',
  from:  'id',
  to:    'artist_id',
  table: 'albums',
  key:   'year',
  value: 'title',
}</code></code></pre>
<p>Then the relation will return:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">{
  1973: 'The Dark Side of the Moon',
  1975: 'Wish You Were Here',
  1970: 'Atom Heart Mother',
}</code></code></pre>
<h2 id="shorthand-syntax-for-defining-relations">Shorthand Syntax for Defining Relations</h2><p>If you've got a simple relation then you can define it as a string
using the shorthand syntax.  The general format for the <code>one</code> relation is:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">from -&gt; table.to</code></code></pre>
<p>For an <code>any</code> relation it uses a "squiggly arrow" instead.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">from ~&gt; table.to</code></code></pre>
<p>For a <code>many</code> relation it uses a "fat arrow".</p>
<pre><code class="lang-js"><code class="source-code prettyprint">from =&gt; table.to</code></code></pre>
<p>For a <code>map</code> relation it uses a "hash arrow" (because another name for a object
mapping keys to values is a "hash array").</p>
<pre><code class="lang-js"><code class="source-code prettyprint">from #&gt; table.to</code></code></pre>
<p>For example, the <code>album</code> relation defined for the <code>tracks</code> table looks
like this:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">// tables.tracks.relations...
album: {
  type:   'one',
  from:   'album_id',
  to:     'id',
  table:  'albums',
},</code></code></pre>
<p>That can be shortened to:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">album: 'album_id -&gt; albums.id'</code></code></pre>
<p>Similarly, the <code>albums</code> relation for <code>artists</code> can be shortened from
this:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">// tables.artists.relations...
albums: {
  type:  'many',
  table: 'albums',
  from:  'id',
  to:    'artist_id',
}</code></code></pre>
<p>To this:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">albums: 'id =&gt; albums.artist_id'</code></code></pre>
<p>You can't specify an <code>order</code> or additional <code>where</code> constraints using this
syntax.  If you need to specify those then you can either use the fully
expanded form:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">// tables.artists.relations...
albums: {
  type:  'many',
  table: 'albums',
  from:  'id',
  to:    'artist_id',
  order: 'year',
}</code></code></pre>
<p>Or you can define the shorthand form as the <code>relation</code> item and add <code>order</code> and/or <code>where</code>
as additional items.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">// tables.artists.relations...
albums: {
  relation: 'id =&gt; albums.artist_id',
  order:    'year',
}</code></code></pre>
<p>The same applies for the <code>key</code> and <code>value</code> properties that go with the <code>map</code> relation.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">// tables.artists.relations...
albumsByYear: {
  relation: 'id #&gt; albums.artist_id',
  key:      'year',
  value:    'title',
}</code></code></pre>
<h2 id="custom-queries">Custom Queries</h2><p>If you want to define a more complex relation then you can provide your own
<code>load</code> function to take care of it.</p>
<p>For example, suppose we want to fetch all the album tracks for a particular
artist, ordered by the album year and then the track number.</p>
<p>We can define a custom query in the <code>queries</code> section of the <code>artists</code> table
definition to load the relevant rows:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">// tables.artists...
queries: {
  album_tracks: `
    SELECT    tracks.*, albums.title as album, albums.year
    FROM      albums
    JOIN      tracks
    ON        tracks.album_id=albums.id
    WHERE     albums.artist_id=$1
    ORDER BY  albums.year,tracks.track_no
  `
}</code></code></pre>
<p>Then we can add an <code>album_tracks</code> relation in the <code>relations</code> section of the same
<code>artists</code> table that looks something like this:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">// tables.artists...
relations: {
  album_tracks: {
    load: async (record) =&gt; {
      const artists = record.table;
      const rows = await artists.all(
        'album_tracks',
        [record.row.id]
      )
      return artists.records(rows);
    }
  }
}</code></code></pre>
<p>The <code>load</code> function is passed a reference to the current record (an artist
in this case).  Each record has a reference to the <code>table</code> object that it
came from.  Through that we can fetch all the relevant rows using the
<code>album_tracks</code> query, passing the current artist id as the value for the
placeholder variable.</p>
<p>You can return the <code>rows</code> as they are, but in this example we'll convert them
to records by calling the <code>records()</code> method on the table.  This ensures
they're returned as record object in case we want to perform any further
record-based operations on them.</p>
<p>Here's the complete definition for the <code>artists</code> table:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">// tables...
artists: {
  columns: 'id name',
  queries: {
    album_tracks: `
      SELECT    tracks.*, albums.title as album, albums.year
      FROM      albums
      JOIN      tracks
      ON        tracks.album_id=albums.id
      WHERE     albums.artist_id=$1
      ORDER BY  albums.year,tracks.track_no
    `
  },
  relations: {
    albums: 'id =&gt; albums.artist_id',
    album_tracks: {
      load: async (record) =&gt; {
        const artists = record.table;
        const rows = await artists.all(
          'album_tracks',
          [record.row.id]
        )
        return artists.records(rows);
      }
    }
  }</code></code></pre>
<p>And here's how we can use it.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const artists = await musicdb.table('artists');
const artist  = await artists.oneRecord({ name: 'Pink Floyd' });
const tracks  = await artist.album_tracks;

// we should now have all the tracks from The Dark Side of the Moon
// followed by all those from Wish You Were Here
console.log(tracks[0].album);  // The Dark Side of the Moon
console.log(tracks[0].year);   // 1973
console.log(tracks[0].title);  // Speak to Me / Breathe

console.log(tracks[1].album);  // The Dark Side of the Moon
console.log(tracks[1].year);   // 1973
console.log(tracks[1].title);  // On the Run

// ...etc...

console.log(tracks[13].album);  // Wish You Were Here
console.log(tracks[13].year);   // 1975
console.log(tracks[13].title);  // Shine On You Crazy Diamond (Parts I-V)</code></code></pre>
<p>There are other ways to achieve a similar result.  For example, you could define
your own <a href="manual/record_class.html">record class</a> for the artists table and add
an <code>albumTracks</code> method:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">export class Artist extends Record {
  async albumTracks() {
    const artists = this.table;
    const rows = await artists.all(
      'album_tracks',
      [this.row.id]
    )
    return artists.records(rows);
  }
}</code></code></pre>
<p>The usage would be almost identical:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const artists = await musicdb.table('artists');
const artist  = await artists.oneRecord({ name: 'Pink Floyd' });
const tracks  = await artist.albumTracks();
// ...as before</code></code></pre>
<p>If you've already defined a record class for a table then this might be the
easier approach.  On the other hand, if you don't already have a record
class then it might be slightly easier to define a custom relation with a
<code>load</code> method to achieve the same effect.</p>
<h2 id="where-next-">Where Next?</h2><p>The next few sections cover some miscellaneous features,
include the the <a href="manual/model.html">model</a> and <a href="manual/waiter.html">waiter</a>.</p>
</div>
</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.5.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>


</body></html>