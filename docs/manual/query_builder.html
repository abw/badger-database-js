<!DOCTYPE html><html><head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../">
  <title data-ice="title">Manual | Badger Database</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<link rel="stylesheet" href="./inject/css/0-badger.css"><meta name="description" content="Javascript database abstraction layer"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="Badger Database"><meta property="twitter:description" content="Javascript database abstraction layer"></head>
<body class="layout-container manual-root" data-ice="rootContainer">

<header>
  <a href="./" style="display: flex; align-items: center;"><img src="./image/brand_logo.svg" style="width:34px;"></a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/abw/badger-database-js"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div class="manual-toc-root">
  
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/installation.html"><a href="manual/installation.html" data-ice="link">Installation</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/installation.html"><a href="manual/installation.html#npm" data-ice="link">npm</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/installation.html"><a href="manual/installation.html#pnpm" data-ice="link">pnpm</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/installation.html"><a href="manual/installation.html#yarn" data-ice="link">yarn</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/connecting.html"><a href="manual/connecting.html" data-ice="link">Connecting</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/connecting.html"><a href="manual/connecting.html#connection-string" data-ice="link">Connection String</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/connecting.html"><a href="manual/connecting.html#connection-parameters" data-ice="link">Connection Parameters</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/connecting.html"><a href="manual/connecting.html#connection-parameter-aliases" data-ice="link">Connection Parameter Aliases</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/connecting.html"><a href="manual/connecting.html#environment-variables" data-ice="link">Environment Variables</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/connecting.html"><a href="manual/connecting.html#pool-options" data-ice="link">Pool Options</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/connecting.html"><a href="manual/connecting.html#disconnecting" data-ice="link">Disconnecting</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/basic_queries.html"><a href="manual/basic_queries.html" data-ice="link">Basic Queries</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/basic_queries.html"><a href="manual/basic_queries.html#run-query--values--options-" data-ice="link">run(query, values, options)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/basic_queries.html"><a href="manual/basic_queries.html#one-query--values--options-" data-ice="link">one(query, values, options)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/basic_queries.html"><a href="manual/basic_queries.html#any-query--values--options-" data-ice="link">any(query, values, options)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/basic_queries.html"><a href="manual/basic_queries.html#all-query--values--options-" data-ice="link">all(query, values, options)</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/named_queries.html"><a href="manual/named_queries.html" data-ice="link">Named Queries</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/query_fragments.html"><a href="manual/query_fragments.html" data-ice="link">Query Fragments</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/query_builder.html"><a href="manual/query_builder.html" data-ice="link">Query Builder</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/query_builder.html"><a href="manual/query_builder.html#getting-started" data-ice="link">Getting Started</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/query_builder.html"><a href="manual/query_builder.html#selecting-columns-from-tables" data-ice="link">Selecting Columns From Tables</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/query_builder.html"><a href="manual/query_builder.html#embedding-raw-sql" data-ice="link">Embedding Raw SQL</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/query_builder.html"><a href="manual/query_builder.html#placeholder-values" data-ice="link">Placeholder Values</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/query_builder.html"><a href="manual/query_builder.html#running-queries" data-ice="link">Running Queries</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/query_builder.html"><a href="manual/query_builder.html#the-importance-of-being-idempotent" data-ice="link">The Importance of Being Idempotent</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/query_builder.html"><a href="manual/query_builder.html#named-queries-using-a-query-builder" data-ice="link">Named Queries Using a Query Builder</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html" data-ice="link">Query Builder Methods</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#select-columns-" data-ice="link">select(columns)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#from-table-" data-ice="link">from(table)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#where-criteria-" data-ice="link">where(criteria)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#join-table-" data-ice="link">join(table)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#order-columns-" data-ice="link">order(columns)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#group-columns-" data-ice="link">group(columns)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#having-criteria-" data-ice="link">having(criteria)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#limit-n-" data-ice="link">limit(n)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#offset-n-" data-ice="link">offset(n)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#range-from--to-" data-ice="link">range(from, to)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#columns-columns-" data-ice="link">columns(columns)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#table-name-" data-ice="link">table(name)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#prefix-prefix-" data-ice="link">prefix(prefix)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#one-values-" data-ice="link">one(values)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#any-values-" data-ice="link">any(values)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/builder_methods.html"><a href="manual/builder_methods.html#all-values-" data-ice="link">all(values)</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/tables.html"><a href="manual/tables.html" data-ice="link">Tables</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tables.html"><a href="manual/tables.html#insert--update--fetch-and-delete" data-ice="link">Insert, Update, Fetch and Delete</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tables.html"><a href="manual/tables.html#table-queries" data-ice="link">Table Queries</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/table_columns.html"><a href="manual/table_columns.html" data-ice="link">Table Columns</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/table_methods.html"><a href="manual/table_methods.html" data-ice="link">Table Methods</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_methods.html"><a href="manual/table_methods.html#insert-methods" data-ice="link">Insert Methods</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#insert-data--options-" data-ice="link">insert(data, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#insertone-data--options-" data-ice="link">insertOne(data, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#insertall-array--options-" data-ice="link">insertAll(array, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#insertonerecord-data--options-" data-ice="link">insertOneRecord(data, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#insertallrecords-array--options-" data-ice="link">insertAllRecords(array, options)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_methods.html"><a href="manual/table_methods.html#update-methods" data-ice="link">Update Methods</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#update-set--where--options-" data-ice="link">update(set, where, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#updateone-set--where--options-" data-ice="link">updateOne(set, where, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#updateany-set--where--options-" data-ice="link">updateAny(set, where, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#updateall-set--where--options-" data-ice="link">updateAll(set, where, options)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_methods.html"><a href="manual/table_methods.html#delete-method" data-ice="link">Delete Method</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#delete-where-" data-ice="link">delete(where)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_methods.html"><a href="manual/table_methods.html#fetch-methods" data-ice="link">Fetch Methods</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#fetch-where--options-" data-ice="link">fetch(where, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#fetchone-where--options-" data-ice="link">fetchOne(where, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#fetchany-where--options-" data-ice="link">fetchAny(where, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#fetchall-where--options-" data-ice="link">fetchAll(where, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#fetchonerecord-where--options-" data-ice="link">fetchOneRecord(where, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#fetchanyrecord-where--options-" data-ice="link">fetchAnyRecord(where, options)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#fetchallrecords-where--options-" data-ice="link">fetchAllRecords(where, options)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_methods.html"><a href="manual/table_methods.html#record-methods" data-ice="link">Record Methods</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#record-row-" data-ice="link">record(row)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/table_methods.html"><a href="manual/table_methods.html#records-rows-" data-ice="link">records(rows)</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/table_queries.html"><a href="manual/table_queries.html" data-ice="link">Table Queries</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_queries.html"><a href="manual/table_queries.html#query-methods" data-ice="link">Query Methods</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_queries.html"><a href="manual/table_queries.html#named-queries" data-ice="link">Named Queries</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_queries.html"><a href="manual/table_queries.html#query-fragments" data-ice="link">Query Fragments</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_queries.html"><a href="manual/table_queries.html#query-builder" data-ice="link">Query Builder</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_queries.html"><a href="manual/table_queries.html#one-query--values--options-" data-ice="link">one(query, values, options)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_queries.html"><a href="manual/table_queries.html#any-query--values--options-" data-ice="link">any(query, values, options)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_queries.html"><a href="manual/table_queries.html#all-query--values--options-" data-ice="link">all(query, values, options)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_queries.html"><a href="manual/table_queries.html#onerow-query--args-" data-ice="link">oneRow(query, args)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_queries.html"><a href="manual/table_queries.html#anyrow-query--args-" data-ice="link">anyRow(query, args)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_queries.html"><a href="manual/table_queries.html#allrows-query--args-" data-ice="link">allRows(query, args)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_queries.html"><a href="manual/table_queries.html#onerecord-query--args-" data-ice="link">oneRecord(query, args)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_queries.html"><a href="manual/table_queries.html#anyrecord-query--args-" data-ice="link">anyRecord(query, args)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_queries.html"><a href="manual/table_queries.html#allrecords-query--args-" data-ice="link">allRecords(query, args)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_queries.html"><a href="manual/table_queries.html#run-query--values--options-" data-ice="link">run(query, values, options)</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/table_class.html"><a href="manual/table_class.html" data-ice="link">Table Class</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/table_class.html"><a href="manual/table_class.html#table-configuration" data-ice="link">Table Configuration</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/records.html"><a href="manual/records.html" data-ice="link">Records</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/record_methods.html"><a href="manual/record_methods.html" data-ice="link">Record Methods</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/record_methods.html"><a href="manual/record_methods.html#update-set-" data-ice="link">update(set)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/record_methods.html"><a href="manual/record_methods.html#delete--" data-ice="link">delete()</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/record_methods.html"><a href="manual/record_methods.html#relation-name-" data-ice="link">relation(name)</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/record_class.html"><a href="manual/record_class.html" data-ice="link">Record Class</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/record_class.html"><a href="manual/record_class.html#record-configuration-options" data-ice="link">Record Configuration Options</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/relations.html"><a href="manual/relations.html" data-ice="link">Relations</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/relations.html"><a href="manual/relations.html#relation-types" data-ice="link">Relation Types</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/relations.html"><a href="manual/relations.html#defining-table-relations" data-ice="link">Defining Table Relations</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/relations.html"><a href="manual/relations.html#fetching-relations" data-ice="link">Fetching Relations</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/relations.html"><a href="manual/relations.html#additional-constraints" data-ice="link">Additional Constraints</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/relations.html"><a href="manual/relations.html#shorthand-syntax-for-defining-relations" data-ice="link">Shorthand Syntax for Defining Relations</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/relations.html"><a href="manual/relations.html#custom-queries" data-ice="link">Custom Queries</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/model.html"><a href="manual/model.html" data-ice="link">Model</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/waiter.html"><a href="manual/waiter.html" data-ice="link">Waiter</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/debugging.html"><a href="manual/debugging.html" data-ice="link">Debugging</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/debugging.html"><a href="manual/debugging.html#sql-parse-errors" data-ice="link">SQL Parse Errors</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/extending.html"><a href="manual/extending.html" data-ice="link">Extending</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/extending.html"><a href="manual/extending.html#custom-tables-class" data-ice="link">Custom Tables Class</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/extending.html"><a href="manual/extending.html#custom-tables-object" data-ice="link">Custom Tables Object</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/extending.html"><a href="manual/extending.html#adding-query-builder-methods" data-ice="link">Adding Query Builder Methods</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/extending.html"><a href="manual/extending.html#adding-a-new-database-engine" data-ice="link">Adding a New Database Engine</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/limitations.html"><a href="manual/limitations.html" data-ice="link">Limitations</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/examples.html"><a href="manual/examples.html" data-ice="link">Examples</a></li>
</ul>
  </div>
</div>
</nav>

<div class="content" data-ice="content"><div class="github-markdown" data-ice="content"><h1 id="query-builder">Query Builder</h1><p>The philosophy of the badger-database library is that ORMs and
SQL query generators are considered <em>Mostly Harmful</em>, especially
if they're employed as an alternative to using SQL.  But that's
not to say that they don't have some benefits.  We like to think
that this implementation has some of those best bits and not too
many of the not-so-good bits.</p>
<ul>
<li><p>Correctness - table and column names are automatically quoted to
avoid any conflict with reserved words.</p>
</li>
<li><p>Syntactic sugar - you can specify multiple tables, columns, etc.,
using a single string for conciseness. You don't need to worry about
defining them as an array, quoting every word or putting commas between
each item.  As long as there's no ambiguity then we take care of that
for you.</p>
</li>
<li><p>Flexibility - queries can be constructed out of sequence, or you
can call the same methods multiple times.  The query builder makes
sure everything ends up in the right order.  Placeholders are
automatically inserted for user-supplied values to prevent SQL injection
attacks, and in the case of Postgres that uses numbered
placeholders (<code>$1</code>, <code>$2</code>, <code>$3</code>, etc), the query builder takes care
of generating them for you so you don't have to worry about getting
them in the wrong order, repeating a number or skipping one.</p>
</li>
<li><p>Reusability - unlike some query builders we could mention, these
queries are idempotent.  That is, they generate the same SQL query
each time they are run (although they won't necessarily return the
same rows from the database if you provide different values for
placeholders or your database has been updated in the interim).
Calling a method on a query builder chain doesn't change any of the
elements that precede it.  This means that you can create partial
queries which you can then use to build multiple different queries
that are variations of it.</p>
</li>
</ul>
<p>There are a number of limitations, most of which are intentional.
The first and most prominent is that we currently only support
select queries.  The reasoning behind this is that insert, update
and delete queries are destructive in that they write to the database.
If you get something wrong because the SQL query is obscured by
using a query builder then you're going to have a bad day.  We don't
want you to have a bad day, especially not on our account.</p>
<p>As described in the <a href="manual/tables.html">tables</a> documentation,
there are already methods provided for inserting, updating and
deleting records and they come with a safety net.  You can mark
table columns as <code>required</code> and/or <code>readonly</code> and the method calls
will be sanity checked for you.  An error will be thrown if you
try to insert or update <code>readonly</code> columns, or insert records
with missing <code>required</code> columns.</p>
<p>If you need to perform an insert, update or delete query that
is any more complicated than that (e.g. requiring a join to another
table) then we highly recommend that you write it as an SQL query
that you can test (on a sacrificial copy of your production database,
of course) and then define as a <a href="manual/named_queries.html">named query</a>.</p>
<p>Another limitation is that we don't support all the SQL elements that
you could possibly want to put in a select query.  Again, this is
deliberate.  We've tried to cover the things that you're likely to
need most often, and provide an easy way to embed raw SQL for those
times when you need something else.  This library does not try
to discourage you from using SQL when you need to.  In fact, it
positively encourages you to do so.</p>
<p>Before we get into too much detail, let's look at some examples.</p>
<h2 id="getting-started">Getting Started</h2><p>We'll start off by importing the <code>connect</code> and <code>sql</code> functions
and connecting to a database.  The wrapper code would look something
like this:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">import { connect, sql } from '@abw/badger-database'

async function main() {
  const db = connect({ database: 'sqlite:memory' });

  // examples go here
}

main()</code></code></pre>
<p>When you create a query, or part of a query, you can call the
<code>sql()</code> method to see what the generated SQL looks like.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">console.log(
  db.select('hello').from('world').sql()
);  // -&gt; SELECT "hello" FROM "world"</code></code></pre>
<p>In these examples we'll omit the <code>console.log()</code> and <code>sql()</code> call
for brevity.</p>
<h2 id="selecting-columns-from-tables">Selecting Columns From Tables</h2><p>The main database object has a <code>select()</code> method which allows you to
start a query by specifying the columns you want to select.  You can
then chain further methods onto it, e.g. <code>from()</code> to specify one or
more tables that you want to select from.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">db.select('hello').from('world')
// -&gt; SELECT "hello" FROM "world"</code></code></pre>
<p>Table and column names are both automatically quoted to avoid conflict
with reserved words.  Even if they're not reserved words <em>now</em>, there's
always the possibility that they could be in the <em>future</em>.  In fact this
happened to me on a project where we updated MySQL and discovered that
<code>rank</code> had become a reserved word - we had numerous tables with a <code>rank</code>
column and it took several hours to go through all the various queries
we used to quote the column.  Lesson learned.</p>
<p>When you pass a string to either of these methods (and many others),
the string will be split into individual table or columns names.  These
will then be quoted and put back together.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">db.select('id name').from('users')
// -&gt; SELECT "id", "name" FROM "users"</code></code></pre>
<p>You can put commas between items (with optional trailing whitespace)
and it works the same, e.g <code>id,name</code> and <code>id, name</code> are both treated
the same as <code>id name</code>.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">db.select('id, name').from('users')
// -&gt; SELECT "id", "name" FROM "users"</code></code></pre>
<p>You can add table names to columns.  Both will be automatically quoted.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">db.select('users.id users.name').from('users')
// -&gt; SELECT "users"."id", "users"."name" FROM "users"</code></code></pre>
<p>You can also start with the <code>from()</code> method if you like.  Generally
speaking, it doesn't matter which order you call methods in.  The query
builder will construct the SQL query in the correct order.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">db.from('users').select('id name')
// -&gt; SELECT "id", "name" FROM "users"</code></code></pre>
<p>NOTE: We don't yet have support for <code>with()</code> but it should be coming soon.
When it does, we will also allow you to start a query with that.</p>
<p>If you want to start a query with anything other than <code>select()</code> or <code>from()</code>
(or <code>with()</code>, coming soon), then you should prefix it with <code>.build</code>.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">db.build.where('c').from('b').select('a')
// -&gt; SELECT "a" FROM "b" WHERE "c" = ?</code></code></pre>
<p>You can call methods multiple times.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">db.select('id').select('name').from('users')
// -&gt; SELECT "id", "name" FROM "users"</code></code></pre>
<p>You can also pass multiple arguments to a method.  Each is processed
in turn as if you had called the method multiple times.  We'll see how
this can be useful with more complex parameters.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">db.select('id', 'name').from('users')
// -&gt; SELECT "id", "name" FROM "users"</code></code></pre>
<p>For example, the <code>select()</code> method allows you to pass an array of
two element.  The first is the column name, the second is an alias.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">db.select(['name', 'user_name']).from('users')
// -&gt; SELECT "name" AS "user_name" FROM "users"</code></code></pre>
<p>The <code>from()</code> method supports the same syntax for creating a table alias.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">db.select('name').from(['users', 'people'])
// -&gt; SELECT "name" FROM "users" AS "people"</code></code></pre>
<p>You can also pass objects to the methods to provide named parameters.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">db.select({ column: 'name', as: 'user_name' }).from('users')
// -&gt; SELECT "name" AS "user_name" FROM "users"</code></code></pre>
<p>Here's an example showing how you can automatically add the table name to
columns and add a prefix to the returned values.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">db.select({ table: 'users', columns: 'id name', prefix: 'user_' }).from('users')
// -&gt; SELECT "users"."id" AS "user_id", "users"."name" AS "user_name" FROM "users"</code></code></pre>
<p>You can use any of the argument types for a method and you can mix and match them
in a single call.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">db.select('id', { table: 'users', columns: 'name email', prefix: 'user_' }).from('users')
// -&gt; SELECT "id", "users"."name" AS "user_name", "users.email" as "user_email" FROM "users"</code></code></pre>
<h2 id="embedding-raw-sql">Embedding Raw SQL</h2><p>The query builder tries to hit the sweet spot by allowing you to generate
<em>most</em> of the simpler queries you might need.  But it doesn't supporting
everything that SQL has to offer because that would greatly increase the
complexity and make it harder to reason about.</p>
<p>As a fallback plan, every method allows you to provide it with raw SQL.
You can pass an object with a single <code>sql</code> property:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">db.select({ sql: 'COUNT(user.id) AS n_users' }).from('users')
// -&gt; SELECT COUNT(user.id) AS n_users FROM "users"</code></code></pre>
<p>Or you can use the <code>sql</code> function to generate a tagged template literal.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">db.select(sql`COUNT(user.id) AS n_users`).from('users')
// -&gt; SELECT COUNT(user.id) AS n_users FROM "users"</code></code></pre>
<p>The benefit here is that you can use SQL for some parts of a query when you
need it, but still rely on the convenience of automatic generation for
other parts that don't.</p>
<h2 id="placeholder-values">Placeholder Values</h2><p>The <code>where()</code> method is used to specify selection criteria.  Any user
supplied values are embedded into the query using placeholders.</p>
<p>The SQL query generated will use placeholders for any <code>where()</code> clauses
included.</p>
<p>For example, this query:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">db.select('id name')
  .from('users')
  .where('id')</code></code></pre>
<p>Will generate a SQL query that looks like this:</p>
<pre><code class="lang-sql"><code class="source-code prettyprint">SELECT "id", "name"
FROM "users"
WHERE "id"=?</code></code></pre>
<p>You can also define values in the <code>where()</code> clause.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const row = db
  .select('id name')
  .from('users')
  .where({ id: 12345 })
  .one();     // automatically uses placeholder values: [12345]</code></code></pre>
<p>The query generated will still use placeholders.  It will also
automatically keep track of the values that go with each placeholder.</p>
<p>If you want to see what placeholder values a query has collected then
you can call the <code>values()</code> method.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const query = db
  .select('id name')
  .from('users')
  .where({ id: 12345 })

console.log(query.values())
// -&gt; [12345]</code></code></pre>
<p>The query builder also provides a <a href="manual/builder_methods.html#having-criteria-">having()</a>
method which works in a similar way.  The query builder collects placeholder values
associated with <code>WHERE</code> clauses separately from those associated with <code>HAVING</code> clauses.
This is because any <code>WHERE</code> clauses come before any <code>HAVING</code> clauses and the placeholder
values must be ordered in that way.</p>
<p>You can call the <code>whereValues()</code> and <code>havingValues()</code> method to see what values have
been collected for them separately.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">console.log(query.whereValues())
// -&gt; [12345]
console.log(query.havingValues())
// -&gt; []</code></code></pre>
<h2 id="running-queries">Running Queries</h2><p>When you've constructed a query you can add the <code>all()</code> method to the end to
fetch all rows matching the query.  It's an asynchronous method so you'll need
to <code>await</code> the response (or use <code>.then(...)</code> if you prefer).</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const rows = await db
  .select('id name')
  .from('users')
  .all();</code></code></pre>
<p>The method returns an array of rows that match the query.</p>
<p>The <code>any()</code> method can be used to return a single row.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const row = await db
  .select('id name')
  .from('users')
  .where({ id: 12345 })
  .any();</code></code></pre>
<p>The method will return a single row or <code>undefined</code> if it doesn't
match a row.</p>
<p>If you're expecting to get one and only one row returned then use the
<code>one()</code> method instead.  This will throw an error if the row isn't
found or if the query returns multiple rows.</p>
<p>You can provide values for placeholders in <code>where()</code> clauses as shown
above, or you can save them all up and pass them as an array to the
<code>one()</code>, <code>any()</code> or <code>all()</code> methods.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const row = await db
  .select('id name')
  .from('users')
  .where('id')
  .any([12345]);</code></code></pre>
<h2 id="the-importance-of-being-idempotent">The Importance of Being Idempotent</h2><p>One benefit of this implementation over some others is that the query
builder chains are <em>idempotent</em>.  That's a fancy way of saying that
adding new links in the chain doesn't affect any of the previous links.</p>
<p>What this means in practice is that you can create a "base" query that
you can use to build other queries from.  Each query exists in its own
independent world and doesn't affect any other.</p>
<p>Consider this query to fetch employees of a company by joining from the
<code>users</code> table to the <code>employees</code> table and then onto the <code>companies</code> table.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const employees = db
  .select(
    'users.name employees.job_title',
    ['companies.name', 'company_name']  // alias companies.name to company_name
  )
  .from('users')
  .join('users.id=employees.user_id')
  .join('employees.company_id=companies.id')</code></code></pre>
<p>We can then use that as the basis to construct a number of other queries.
For example, to fetch an employee by user id:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const row = await employees
  .where('users.id')
  .one([12345])</code></code></pre>
<p>Or to fetch all employees for a company:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const rows = await employees
  .where('companies.id')
  .one([98765])</code></code></pre>
<p>Or to fetch all employees with a particular job title:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const rows = await employees
  .where('employees.job_title')
  .all(['Chief Badger'])</code></code></pre>
<p>Each query is entirely independent from the others.</p>
<p>Furthermore, the fact that the query builder allows you to call methods
out of sequence means that you're not limited to tagging new method calls
onto the end of the base query.  For example, you can <code>select()</code> additional
columns in one of the new queries if there's something extra you need that
isn't in the base query.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const rows = await employees
  .select('users.id')
  .where('employees.job_title')
  .all(['Chief Badger'])</code></code></pre>
<h2 id="named-queries-using-a-query-builder">Named Queries Using a Query Builder</h2><p>You can define <a href="manual/named_queries.html">named queries</a> that use the query
builder to generate the SQL.</p>
<p>The named query should be defined as a function.  It will be passed a reference
to the database and should return a query generated using the query builder.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const db = connect({
  database: 'sqlite:memory',
  queries: {
    selectUserByName:
      db =&gt; db
        .select('name email')
        .from('users')
        .where('name')
  }
});</code></code></pre>
<p>You can then use the named query just like any other named query.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const bobby = await db.one(
  'selectUserByName',
  ['Bobby Badger']
);</code></code></pre>
<p>You can use the <code>query()</code> method to fetch a named query.  If it's
constructed using the query builder then you can call further methods
on it to create a more specialised query.  Remember, the original named
query won't be affected so it's perfectly safe to do this.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const bobby = await db
  .query('selectUserByName')
  .select('id')   // also select user id
  .one(['Bobby Badger']);</code></code></pre>
<p>You can even do this to create named queries based on other named queries.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const db = connect({
  database: 'sqlite:memory',
  queries: {
    // "base" query to select a user
    selectUser:
      db =&gt; db
        .select('name email')
        .from('users')  // SELECT "name", "email" FROM "users"

    // specialised version to select a user by name
    selectUserByName:
      db =&gt; db
        .query('selectUser')
        .where('name')  // SELECT "name", "email" FROM "users" WHERE "name" = ?

    // specialised version to select a user by email
    selectUserByName:
      db =&gt; db
        .query('selectUser')
        .where('email') // SELECT "name", "email" FROM "users" WHERE "email" = ?
  }
});

const bobby = db.one(
  'selectUserByName',
  ['Bobby Badger']
);

const brian = db.one(
  'selectUserByEmail',
  ['brian@badgerpower.com']
);</code></code></pre>
<p>You can provide parameters in named queries and they will be "remembered" when
you come to run the query.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const db = connect({
  database: 'sqlite:memory',
  queries: {
    fetchAllBadgers:
      db =&gt; db
        .select('name email')
        .from('users')
        .where({ animal: 'Badger' })
  }
});

const badgers = await db.all('fetchAllBadgers')</code></code></pre>
<p>The <code>sql()</code> method can be used to view the SQL generated by a named
query builder.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">db.sql('fetchAllBadgers')
// -&gt; SELECT "name", "email"
//    FROM "users"
//    WHERE "animal" = ?</code></code></pre>
<p>If you want to see what placeholder values the query has got defined then</p>
</div>
</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.5.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>


</body></html>