import{_ as e,o as a,c as t,a2 as r}from"./chunks/framework.md-CufnD.js";const g=JSON.parse('{"title":"Implementation Details","description":"","frontmatter":{},"headers":[],"relativePath":"implementation.md","filePath":"implementation.md","lastUpdated":1709228065000}'),o={name:"implementation.md"},s=r('<h1 id="implementation-details" tabindex="-1">Implementation Details <a class="header-anchor" href="#implementation-details" aria-label="Permalink to &quot;Implementation Details&quot;">​</a></h1><p>This section talks about how the library is implemented. It&#39;s aimed at people who are looking to maintain or extend the library, find and fix bugs, or are looking to use it in a project and want to convince themselves that it&#39;s suffiently well written and easy to reason about, should they ever need to maintain or extend it themselves.</p><h2 id="total-cost-of-ownership" tabindex="-1">Total Cost of Ownership <a class="header-anchor" href="#total-cost-of-ownership" aria-label="Permalink to &quot;Total Cost of Ownership&quot;">​</a></h2><p>Free and Open Source software is fantastic. If you have a problem you need to solve then you can spend days, weeks or months writing your own solution, or you can download and use an Open Source library with a single command. Not only is it free to use, but also has a greater chance of being well documented and reliable. It has (hopefully) been well tested by the author and is widely used in the community, increasing the chances that any bugs in it have already been found and fixed. Software quality isn&#39;t something that happens overnight.</p><p>However, it&#39;s important to understand that there are hidden costs in using any piece of software. Even if you don&#39;t have to pay any money to install and use it, you still have to consider the ongoing costs associated with maintenance. If at some time in the future you find a bug or want to add a new feature, you may find that the original author has stopped maintaining the code, isn&#39;t interested in fixing the bug that you&#39;ve found, doesn&#39;t want to add your new feature, has retired and gone to live in a llama colony in Outer Mongolia, or has simply disappeared off the face of the Earth. At this point, you&#39;re potentially on your own.</p><p>Before building your next big dotcom enterprise around any this library, or indeed any key piece of technology, you should invest at least some of the time you would have otherwise spent writing it yourself in getting to know it. Not only understanding how to use it, but also getting a feel for how it works, evaluating the quality of the codebase, and considering how easy it would be for you, or your future colleagues to maintain it, should you ever need to.</p><p>Given that this is a new library as of 2022 (albeit one that is based on a similar library written in Perl that&#39;s been used in production for nearly 20 years) that at the time of writing has a user base measured in single figures, you should be especially cautious about adopting it without performing due diligence.</p><p>This document provides a high-level overview of how <code>badger-database</code> works to help you with that process.</p><h2 id="key-components" tabindex="-1">Key Components <a class="header-anchor" href="#key-components" aria-label="Permalink to &quot;Key Components&quot;">​</a></h2><p>The <a href="https://github.com/abw/badger-database-js/blob/master/src/Database.js" target="_blank" rel="noreferrer">Database</a> module is the main interface to the library. This is what gets returned by the <a href="./connecting.html"><code>connect()</code></a> function (defined down at the bottom of the <a href="https://github.com/abw/badger-database-js/blob/master/src/Database.js" target="_blank" rel="noreferrer">Database.js</a> file).</p><p>The <a href="https://github.com/abw/badger-database-js/blob/master/src/Database.js" target="_blank" rel="noreferrer">Database</a> module is a subclass of the <a href="https://github.com/abw/badger-database-js/blob/master/src/Queryable.js" target="_blank" rel="noreferrer">Queryable</a> module. This is the base class that implements the basic <a href="./basic-queries.html#run-query-values-options"><code>run()</code></a>, <a href="./basic-queries.html#one-query-values-options"><code>one()</code></a>, <a href="./basic-queries.html#any-query-values-options"><code>any()</code></a> and <a href="./basic-queries.html#all-query-values-options"><code>all()</code></a> methods.</p><p>The <a href="https://github.com/abw/badger-database-js/blob/master/src/Table.js" target="_blank" rel="noreferrer">Table</a> module is also a subclass of <a href="https://github.com/abw/badger-database-js/blob/master/src/Queryable.js" target="_blank" rel="noreferrer">Queryable</a> so that it also inherits those same basic query methods.</p><p>The <a href="https://github.com/abw/badger-database-js/blob/master/src/Engine.js" target="_blank" rel="noreferrer">Engine</a> module is used by the <a href="https://github.com/abw/badger-database-js/blob/master/src/Queryable.js" target="_blank" rel="noreferrer">Queryable</a> classes as a lower-level interface to the database. It handles communicating with the underlying database driver and provides methods for accessing the connection pool, preparing and executing queries, and formatting SQL fragments, e.g. quoting columns and table names, generating placeholders, etc.</p><p>There are three subclasses of the <a href="https://github.com/abw/badger-database-js/blob/master/src/Engine.js" target="_blank" rel="noreferrer">Engine</a> module which are specialised for the different databases supported: <a href="https://github.com/abw/badger-database-js/blob/master/src/Engine/Sqlite.js" target="_blank" rel="noreferrer">Sqlite</a>, <a href="https://github.com/abw/badger-database-js/blob/master/src/Engine/Mysql.js" target="_blank" rel="noreferrer">Mysql</a> and <a href="https://github.com/abw/badger-database-js/blob/master/src/Engine/Postgres.js" target="_blank" rel="noreferrer">Postgres</a>.</p><p>The <a href="https://github.com/abw/badger-database-js/blob/master/src/Engines.js" target="_blank" rel="noreferrer">Engines</a> module is an <a href="https://github.com/abw/badger-database-js/blob/master/src/Engine.js" target="_blank" rel="noreferrer">Engine</a> provider. It implements the functionality to allow engines to be registered and then used by specifying a driver protocol (e.g. <code>sqlite</code>, <code>mysql</code>, <code>mariadb</code>, <code>postgres</code> or <code>postgresql</code>).</p><p>The <a href="https://github.com/abw/badger-database-js/blob/master/src/Database.js" target="_blank" rel="noreferrer">Database</a> module implements the <a href="./tables.html"><code>table()</code></a> method for create new <a href="https://github.com/abw/badger-database-js/blob/master/src/Table.js" target="_blank" rel="noreferrer">Table</a> objects. It uses the <a href="https://github.com/abw/badger-database-js/blob/master/src/Tables.js" target="_blank" rel="noreferrer">Tables</a> module as a &quot;provider&quot;. This module is ridiculously simply, but it exists as an extension point so that you can implement your own <a href="https://github.com/abw/badger-database-js/blob/master/src/Tables.js" target="_blank" rel="noreferrer">Tables</a> provider if you want to change the way that table configurations details are defined (for example, I have a number of projects where the table definitions are in YAML files that get loaded when the table is first used).</p><p>The <a href="https://github.com/abw/badger-database-js/blob/master/src/Table.js" target="_blank" rel="noreferrer">Table</a> module is also intended to be an extension point. It implements a number of methods providing the basic CRUD functions (Create, Read, Update, Delete) in various flavours (one, any, all, returning rows or records) that should cover most basic row-based operations. When you need to add custom queries, business logic or other functionality relating to a particular table then you can create your own subclass of the <a href="https://github.com/abw/badger-database-js/blob/master/src/Table.js" target="_blank" rel="noreferrer">Table</a> module and hook it in.</p><p>Various <a href="https://github.com/abw/badger-database-js/blob/master/src/Table.js" target="_blank" rel="noreferrer">Table</a> methods have an option to return rows as <a href="./records.html">records</a>. The base class <a href="https://github.com/abw/badger-database-js/blob/master/src/Record.js" target="_blank" rel="noreferrer">Record</a> module provides some basic methods for updating the record, deleting it or fetching related records. The more important role is as another extension point. You can subclass it to create your own record modules where you can add data validation, business logic or other functionality relating to individual entities.</p><p>The <a href="https://github.com/abw/badger-database-js/blob/master/src/Table.js" target="_blank" rel="noreferrer">Table</a> methods that return records don&#39;t return a <a href="https://github.com/abw/badger-database-js/blob/master/src/Record.js" target="_blank" rel="noreferrer">Record</a> object directly, but instead return a <a href="https://github.com/abw/badger-database-js/blob/master/src/Proxy/Record.js" target="_blank" rel="noreferrer">Record Proxy</a> wrapper around the record. This proxy allows you to access the <code>record.row</code> components without having to specify the <code>.row</code> part (e.g. <code>record.id</code> is short for <code>record.row.id</code>) and also provide access to record relations.</p><p>The <a href="https://github.com/abw/badger-database-js/tree/master/src/Relation" target="_blank" rel="noreferrer">Relation</a> modules implement the queries to fetch related records for different relation types: <a href="https://github.com/abw/badger-database-js/blob/master/src/Relation/one.js" target="_blank" rel="noreferrer">one</a>, <a href="https://github.com/abw/badger-database-js/blob/master/src/Relation/any.js" target="_blank" rel="noreferrer">any</a>, <a href="https://github.com/abw/badger-database-js/blob/master/src/Relation/many.js" target="_blank" rel="noreferrer">many</a> and <a href="https://github.com/abw/badger-database-js/blob/master/src/Relation/many.js" target="_blank" rel="noreferrer">map</a>. Most of them are very simple, being no more than 10 lines of code.</p><p>The <a href="https://github.com/abw/badger-database-js/blob/master/src/Builder.js" target="_blank" rel="noreferrer">Builder</a> module is the base class for components that are used to build SQL queries. There are numerous subclasses, one for each builder method, e.g. <a href="https://github.com/abw/badger-database-js/blob/master/src/Builder/Select.js" target="_blank" rel="noreferrer">Select</a>, <a href="https://github.com/abw/badger-database-js/blob/master/src/Builder/From.js" target="_blank" rel="noreferrer">From</a>, <a href="https://github.com/abw/badger-database-js/blob/master/src/Builder/Where.js" target="_blank" rel="noreferrer">Where</a>, <a href="https://github.com/abw/badger-database-js/blob/master/src/Builder/Insert.js" target="_blank" rel="noreferrer">Insert</a>, <a href="https://github.com/abw/badger-database-js/blob/master/src/Builder/Into.js" target="_blank" rel="noreferrer">Into</a>, and so on.</p><p>The <a href="https://github.com/abw/badger-database-js/blob/master/src/Builders.js" target="_blank" rel="noreferrer">Builders</a> module is the provider for <code>Builder</code> components, where they can be registered and used.</p><p>The <a href="https://github.com/abw/badger-database-js/blob/master/src/Proxy/Builder.js" target="_blank" rel="noreferrer">Builder Proxy</a> is a bit of magic sauce that allows one builder component to chain other builder components onto it. When you call the <code>db.select(...)</code> method, for example, it creates a <a href="https://github.com/abw/badger-database-js/blob/master/src/Builder/Select.js" target="_blank" rel="noreferrer">Select</a> builder component and returns a builder proxy wrapper around it. When you call the <code>from(...)</code> method on that, it creates a <a href="https://github.com/abw/badger-database-js/blob/master/src/Builder/From.js" target="_blank" rel="noreferrer">From</a> builder components, passing it a reference to the &quot;parent&quot; component that it&#39;s attached to, and returns a builder proxy around that. And so the process continues...</p><p>When you want to run a query built this way, e.g. by calling <code>run()</code>, <code>one()</code>, <code>any()</code> or <code>all()</code>, these methods first call the <code>sql()</code> method to generate the query as SQL. The final builder component in the chain asks its parent for everything it knows about (the builder context) and then adds its own information to it. The parent does the same thing - asking its parent for a context and then adding its own information to it. So the context requests bubble up the chain, and the context information is then passed back down. At each step, a new context object is created so that builder components don&#39;t affect any previous components in the chain. Once all the context information has been collected, it&#39;s then a relatively simple process of generating the SQL for each component type (by calling the <code>generateSQL()</code> static class method) and then combining the fragments together in the right order.</p><p>When a SQL query has been built using the <a href="./query-builder.html">query builder</a>, or if you&#39;re running a <a href="./named-queries.html">named query</a> or a raw SQL query, it is wrapped up as a <a href="https://github.com/abw/badger-database-js/blob/master/src/Query.js" target="_blank" rel="noreferrer">Query</a> object before being passed to the <a href="https://github.com/abw/badger-database-js/blob/master/src/Engine.js" target="_blank" rel="noreferrer">Engine</a> to execute. This provides a level of abstraction so that the higher levels don&#39;t have to worry about the difference between running a raw SQL query or a query built using the query builder - the <a href="https://github.com/abw/badger-database-js/blob/master/src/Query.js" target="_blank" rel="noreferrer">Query</a> object takes care of that. It also deals with combining placeholder values from the query builder and any that you pass to the query execution methods <code>run()</code>, <code>one()</code>, <code>any()</code> and <code>all()</code>.</p><p>The <a href="https://github.com/abw/badger-database-js/blob/master/src/Transaction.js" target="_blank" rel="noreferrer">Transaction</a> module is used to run transactions. It implements methods to handle the <code>commit()</code> and <code>rollback()</code> and maintains the state so that it can tell if one or the other has been called. It also acquires a dedicated database connection from the <a href="https://github.com/abw/badger-database-js/blob/master/src/Engine.js" target="_blank" rel="noreferrer">Engine</a> to ensure that all queries run within the scope of the transaction use the same connection.</p><h2 id="conclusion" tabindex="-1">Conclusion <a class="header-anchor" href="#conclusion" aria-label="Permalink to &quot;Conclusion&quot;">​</a></h2><p>That&#39;s just about all there is to it. At the time of writing it&#39;s around 4,000 lines of code. That&#39;s an order of magnitude less than some of the other popular Javascript ORMs and SQL query builders out there, and around 30 times less code than one of the more comprehensive &quot;next generation&quot; ORMs. It is perhaps not a fair comparison as other libraries may do a lot more than <code>badger-database</code>, but the point is to illustrate that this is one of the <em>simpler</em> and <em>less intrusive</em> solutions that exists for adding database functionality to your project.</p><p>It doesn&#39;t aim to be a library that you can use as an <em>alternative</em> to using SQL (although that may be true for some simpler projects), but rather to give you tools that <em>help</em> you work with SQL. In particular, the focus is on automating some of the simple, boring tasks that are an inherent part of using a database so that you have time to focus on the more complicated things that are harder to automate.</p>',29),n=[s];function i(l,h,b,d,c,u){return a(),t("div",null,n)}const p=e(o,[["render",i]]);export{g as __pageData,p as default};
